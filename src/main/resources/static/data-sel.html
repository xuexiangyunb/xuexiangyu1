<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>历史数据</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="lib/layui/css/layui.css">
    <link rel="stylesheet" href="css/scroll-bar.css">
    <link rel="stylesheet" href="css/sub-page.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_693759_wytlyqhtdtj1nhfr.css">
</head>
<body>
<div class="ok-body">
    <!--面包屑导航区域 -->
    <div class="ok-body-breadcrumb">
            <span class="layui-breadcrumb">
             <a><cite>开关柜查询</cite></a>
                <a><cite>开关柜信息列表</cite></a>
				<a><cite>历史数据查询</cite></a>
            </span>
        <a class="layui-btn layui-btn-small" href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon layui-icon-refresh"></i>
        </a>
    </div>
    <!--模糊搜索区域-->
    <div class="layui-row">
        <form class="layui-form layui-col-md12 ok-search">

            <input class="layui-input" name="site" id="site" placeholder="请输入柜子编号" autocomplete="off">
            <button class="layui-btn" lay-submit="" lay-filter="search">
                <i class="layui-icon layui-icon-search"></i>
            </button>
        </form>
    </div>
    <okToolbar>
        <button class="layui-btn" id="download" onclick="method('tableId')">
            <i class="layui-icon">&#xe63c;</i>导出excel
        </button>
        <span>共有数据：<i id="countNum"></i> 条</span>
    </okToolbar>
    <table class="layui-hide" id="tableId" lay-filter="tableFilter"></table>
</div>
<!--js逻辑-->
<script src="lib/layui/layui.js"></script>
<script src="lib/nprogress/nprogress.js"></script>
<!-- form表单 -->

</div>
<!-- js逻辑 -->


<script>
    var cId = null;
    function child(d) {
        cId=d

        //在这里你可以写你的jquery $(function(){ })   等等操作


    layui.use(['element', 'table', 'form', 'jquery', 'laydate'], function () {
        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        var $ = layui.jquery;
        var laydate = layui.laydate;

        /*  $(function(){

             alert(layui.v);

             }); */
        laydate.render({
            elem: '#birthday',
            type: "datetime"
        });

        /*form.verify({
            birthdayVerify: [/^((((1[6-9]|[2-9]\d)\d{2})-(0?[13578]|1[02])-(0?[1-9]|[12]\d|3[01]))|(((1[6-9]|[2-9]\d)\d{2})-(0?[13456789]|1[012])-(0?[1-9]|[12]\d|30))|(((1[6-9]|[2-9]\d)\d{2})-0?2-(0?[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))-0?2-29-))(\s(([01]\d{1})|(2[0123])):([0-5]\d):([0-5]\d))?$/, '日期格式不正确']
        });
        var para = null;
        $.ajax({
            url: "",
            type: "post",
            dataType: "json",
            data:{
                id:id,
            },
            success: function(data){
                para = data;
                //alert(para.r_address);
                //表单初始赋值
                $('input[name="r_address"]').val(para.r_address),
                    $('input[name="r_type"]').val(para.r_type),
                    $('input[name="r_maxnumber"]').val(para.r_maxnumber),
                    $('input[name="r_checknumber"]').val(para.r_checknumber),
                    $('input[name="r_money"]').val(para.r_money),
                    $('input[name="r_paymoney"]').val(para.r_paymoney),
                    $('input[name="r_landlady"]').val(para.r_landlady),
                    $('input[name="r_landladyphone"]').val(para.r_landladyphone),
                    $('input[name="r_states"]').val(para.r_states),
                    $('input[name="r_sex"]').val(para.r_sex),
                    $('input[name="r_time"]').val(para.r_time)

            }
        });
        form.val('roominfo', {

            "r_address": para.r_address,
            "r_type": para.r_type,
            "r_maxnumber": para.r_maxnumber,
            "r_checknumber": para.r_checknumber,
            "r_money": para.r_money,
            "r_paymoney": para.r_paymoney,
            "r_landlady": para.r_landlady,
            "r_landladyphone": para.r_landladyphone,
            "r_states": para.r_states,
            "r_sex": para.r_sex,
            "r_time": para.r_time
          }); */
        table.render({

            elem: '#tableId',
            url: 'listData?cId='+cId,

            //limit: 10,
            page: false,
            cols: [[
                {type: 'checkbox'},
                {field: 'id', title: 'ID', width: 80, sort: true},
                {field: 'tem', title: '温度', width: 100,},
                {field: 'hum', title: '湿度(%)', width: 100,},
                {field: 'time', title: '时间', width: 200},
                // {title: '操作', width: 200, align: 'center', templet: '#operationTpl',}
            ]],
            /* done: function (res, curr, count) {
                $("#countNum").text(count);
            } */
        });

        form.on('submit(edit)', function (data) {
            console.log(cId);
            layer.msg("谢谢查看！", {icon: 6, time: 1000, anim: 4}, function () {
                parent.layer.close(parent.layer.getFrameIndex(window.name));
            });
            return false;
        });
    })
    }
    /*
    * 生成excel
    * */
    function getExplorer() {
        var explorer = window.navigator.userAgent;
        //ie
        if (explorer.indexOf("MSIE") >= 0) {
            return 'ie';
        }
        //firefox
        else if (explorer.indexOf("Firefox") >= 0) {
            return 'Firefox';
        }
        //Chrome
        else if (explorer.indexOf("Chrome") >= 0) {
            return 'Chrome';
        }
        //Opera
        else if (explorer.indexOf("Opera") >= 0) {
            return 'Opera';
        }
        //Safari
        else if (explorer.indexOf("Safari") >= 0) {
            return 'Safari';
        }
    }

    function method(tableid) {
        if (getExplorer() == 'ie') {
            var curTbl = document.getElementById(tableid);
            var oXL = new ActiveXObject("Excel.Application");
            var oWB = oXL.Workbooks.Add();
            var xlsheet = oWB.Worksheets(1);
            var sel = document.body.createTextRange();
            sel.moveToElementText(curTbl);
            sel.select();
            sel.execCommand("Copy");
            xlsheet.Paste();
            oXL.Visible = true;

            try {
                var fname = oXL.Application.GetSaveAsFilename("Excel.xls", "Excel Spreadsheets (*.xls), *.xls");
            } catch (e) {
                print("Nested catch caught " + e);
            } finally {
                oWB.SaveAs(fname);
                oWB.Close(savechanges = false);
                oXL.Quit();
                oXL = null;
                idTmr = window.setInterval("Cleanup();", 1);
            }
        }
        else {
            tableToExcel(tableid)
        }
    }

    function Cleanup() {
        window.clearInterval(idTmr);
        CollectGarbage();
    }

    var tableToExcel = (function () {
        var uri = 'data:application/vnd.ms-excel;base64,',
            template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel"' +
                'xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet>'
                + '<x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets>'
                + '</x:ExcelWorkbook></xml><![endif]-->' +
                ' <style type="text/css">' +
                '.excelTable  {' +
                'border-collapse:collapse;' +
                ' border:thin solid #999; ' +
                '}' +
                '   .excelTable  th {' +
                '   border: thin solid #999;' +
                '  padding:20px;' +
                '  text-align: center;' +
                '  border-top: thin solid #999;' +
                ' background-color: #E6E6E6;' +
                ' }' +
                ' .excelTable  td{' +
                ' border:thin solid #999;' +
                '  padding:2px 5px;' +
                '  text-align: center;' +
                ' }</style>' +
                '</head><body ><table class="excelTable">{table}</table></body></html>',
            base64 = function (s) {
                return window.btoa(unescape(encodeURIComponent(s)))
            },
            format = function (s, c) {
                return s.replace(/{(\w+)}/g,
                    function (m, p) {
                        return c[p];
                    })
            }
        return function (table, name) {
            if (!table.nodeType) table = document.getElementById(table)
            var ctx = {worksheet: name || 'Worksheet', table: table.innerHTML}
            window.location.href = uri + base64(format(template, ctx))
        }
    })()


</script>
</body>
</html>